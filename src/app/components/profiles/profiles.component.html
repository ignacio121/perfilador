<div class="header-step">
  <div class="circle"> 2 </div>
  <h2>Asignar perfil</h2>
</div>

<p class="text">Selecciona el perfil que tendrá <strong>{{nombreUsuario}}</strong> </p>

<div class="perfiles-container">
  <div class="perfil-card" [class.active]="perfilSeleccionado() === 'basico'" (click)="perfilSeleccionado.set('basico')">
    <label class="radio-container">
      <input
        type="radio"
        name="perfil"
        [checked]="perfilSeleccionado() === 'basico'"
        (change)="perfilSeleccionado.set('basico')"
      />
      <span class="custom-radio"></span>
    </label>
    <h3>Básico</h3>
    <p class="text-card"> Este perfil tiene acceso a los siguientes módulos:</p>
    <div class="group-checkbox">
      <mat-checkbox [checked]="true" [disabled]="true" class="custom-checkbox"> Información de ventas y abonos </mat-checkbox>
      <mat-checkbox [checked]="true" [disabled]="true" class="custom-checkbox"> Reportes y facturas </mat-checkbox>
      <mat-checkbox [checked]="true" [disabled]="true" class="custom-checkbox"> Solicitudes </mat-checkbox>
    </div>
  </div>

  <div class="perfil-card" [class.active]="perfilSeleccionado() === 'avanzado'" (click)="perfilSeleccionado.set('avanzado')">
    <label class="radio-container">
      <input
        type="radio"
        name="perfil"
        [checked]="perfilSeleccionado() === 'avanzado'"
        (change)="perfilSeleccionado.set('avanzado')"
      />
      <span class="custom-radio"></span>
    </label>
    <h3>Avanzado</h3>
    <p class="text-card"> Este perfil tiene acceso a los siguientes módulos:</p>
    <div class="group-checkbox">
      <mat-checkbox [checked]="true" [disabled]="true" class="custom-checkbox"> Información de ventas y abonos </mat-checkbox>
      <mat-checkbox [checked]="true" [disabled]="true" class="custom-checkbox"> Reportes y facturas </mat-checkbox>
      <mat-checkbox [checked]="true" [disabled]="true" class="custom-checkbox"> Solicitudes </mat-checkbox>
    </div>
    <p class="advanced-permissions">Permisos avanzados</p>
    <div class="group-checkbox">
      <mat-checkbox [checked]="true" [disabled]="true" class="custom-checkbox"> Anular ventas </mat-checkbox>
      <mat-checkbox [checked]="true" [disabled]="true" class="custom-checkbox"> Resolución de contracargos </mat-checkbox>
      <mat-checkbox [checked]="true" [disabled]="true" class="custom-checkbox"> Reportes estratégicos </mat-checkbox>
    </div>

    <p class="advanced-permissions">Administrador de usuarios</p>
    <mat-checkbox
      [checked]="adminSeleccionado().active && adminSeleccionado().perfil === 'avanzado'"
      (change)="onToggleAdmin($event.checked)"
      class="custom-checkbox"
    >
      Administrador de usuarios
    </mat-checkbox>


  </div>

  <div class="perfil-card" [class.active]="perfilSeleccionado() === 'personalizado'" (click)="perfilSeleccionado.set('personalizado')">
    <label class="radio-container">
      <input
        type="radio"
        name="perfil"
        [checked]="perfilSeleccionado() === 'personalizado'"
        (change)="perfilSeleccionado.set('personalizado')"
      />  
      <span class="custom-radio"></span>
    </label>
    <h3>Personalizado</h3>
    <p class="text-card"> Selecciona los permisos que deseas asignar:</p>
    <div class="group-checkbox">
      @for (permiso of subpermisosBasicos; track permiso) {
        <mat-checkbox
          [checked]="subpermisosSeleccionados().includes(permiso)"
          (change)="toggleSubpermiso(permiso)"
          class="custom-checkbox">
          {{ mapPermisoLegible(permiso) }}
        </mat-checkbox>
      }
    </div>
    
    <p class="advanced-permissions">Permisos avanzados</p>
    <div class="group-checkbox">
      @for (permiso of subpermisosAvanzados; track permiso) {
        <mat-checkbox
          [checked]="subpermisosSeleccionados().includes(permiso)"
          (change)="toggleSubpermiso(permiso)"
          class="custom-checkbox">
          {{ mapPermisoLegible(permiso) }}
        </mat-checkbox>
      }
    </div>
    
    <p class="advanced-permissions">Administrador de usuarios</p> 
    <mat-checkbox
      [checked]="adminSeleccionado().active && adminSeleccionado().perfil === 'personalizado'"
      (change)="onToggleAdmin($event.checked)"
      class="custom-checkbox"
    >
      Administrador de usuarios
    </mat-checkbox>


  </div>
</div>

<div class="buttons-container">
  <button class="secundary-button" (click)="Atras()">
    Atrás
  </button>

  <button class="button" [disabled]="!perfilValido()" (click)="guardarPerfil()">
    Siguiente
  </button>
</div>

